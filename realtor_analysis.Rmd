---
title: "realtor_census_analysis.rmd"
output: html_document
author: "Miguel Rondon"
date: "2022-10-01"
---

Interest in county information stems from information that individuals would 
like to know for home buying. This Analysis utilizes both census demographic
data as well as aggregate real estate information at the county level in order 
to provide a visual of where individuals stand in terms of housing by county in
the United States. This study specifically looks at the median listing price of 
a home by county, median square feet by county, what the largest racial/ethnic
group is in a county, and the overall county population size. The goal of this 
study is to determine the best counties for individuals to look into house. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rgdal)
```

# Simple Ingestion of only necessary data. 
```{r load analytical file}

rcdf <- read.csv("analytical_files/realtor_census.csv") %>% 
  select(2,19, 18, 5:17, 23:32) %>% 
  filter(!is.na(total_hispanic_or_latino))


``` 

#transforming data so that it can be used for analysis.
``` {r next}
rcdf2 <- rcdf %>% 
  mutate(total_pop = total,
         total_pop_white_perc = total_population_of_one_race_white_alone / total_pop,
         total_pop_black_perc = total_population_of_one_race_black_or_african_american_alone / total_pop,
         total_pop_american_indigenous_perc = total_population_of_one_race_american_indian_and_alaska_native_ / total_pop,
         total_pop_asian_perc = total_population_of_one_race_asian_alone / total_pop, 
total_pop_pacific_islander_perc = 
  total_population_of_one_race_native_hawaiian_and_other_pacific_ / total_pop,
         total_pop_other_perc = total_population_of_one_race_some_other_race_alone / total_pop, 
         total_pop_mixed_races_perc = total_population_of_two_or_more_races / total_pop,
         total_pop_hispanic_perc = total_hispanic_or_latino / total_pop,
         county_pop_size = case_when(total_pop < 50000 ~ "Non Metro",
                                     total_pop < 250000 ~ "Small Metro",
                                     total_pop < 1000000 ~ "Mid Metro", 
                                     total_pop >= 1000000 ~ "Large Metro"
                                     ),
        most_pop_perc = pmax(total_pop_white_perc, total_pop_black_perc, total_pop_american_indigenous_perc,
                         total_pop_asian_perc, total_pop_pacific_islander_perc, total_pop_other_perc,
                         total_pop_mixed_races_perc, total_pop_hispanic_perc),
         largest_race_group = case_when(total_pop_hispanic_perc == most_pop_perc ~ "Hispanic",
                                   total_pop_white_perc == most_pop_perc ~ "White",
                                   total_pop_black_perc == most_pop_perc ~ "Black",
                                   total_pop_american_indigenous_perc == most_pop_perc ~ "Native American", 
                                   total_pop_asian_perc == most_pop_perc ~ "Asian", 
                                   total_pop_pacific_islander_perc == most_pop_perc ~ "Pacific Islander", 
                                   total_pop_other_perc > most_pop_perc ~ "Other Race", 
                                   total_pop_mixed_races_perc > most_pop_perc ~ "Mixed Races",
                                   total_pop_white_perc == most_pop_perc ~ "White"
                                   )
         ) %>% 
  filter(!is.na(median_listing_price), !is.na(median_square_feet)
    #new_listing_count > 0,
         #majority_hisp_or_race == "Majority Native American"
         #median_listing_price < 500000, 
         #majority_hisp_or_race != "Majority White"
         #majority_hisp_or_race != "No Majority Race", 
         #county_pop_size != "Non Metropolitan",
         #county_pop_size == "Large Metropolitan"
         #majority_hisp_or_race == "Majority Black"
    )
  #filter(county_pop_size != 'Non Metropolitan', majority_hisp_or_race == "Majority Hispanic")
  
  #filter(total_pop_hispanic_perc > .5)#, median_listing_price < 750000)#, county_pop_size != 'Non Metropolitan')

```

#Getting familiar with the data, then Getting rid of outliers that may skews the
data further, then utilizing a histogram to view the data.
```{r median_listing_price_summary}
summary(rcdf2$median_listing_price)

listing_price_mean <- mean(rcdf2$median_listing_price)

listing_price_sd <- sd(rcdf2$median_listing_price)

sample_top <- listing_price_mean + (listing_price_sd * 3) 
sample_bottom <- listing_price_mean - (listing_price_sd * 3)

sample_rcdf <- rcdf2 %>% 
 filter(median_listing_price >= sample_bottom, median_listing_price <= sample_top)

ggplot(sample_rcdf, aes(median_listing_price / 100000)) +geom_histogram()

summary(sample_rcdf$median_listing_price)

```

#There is some correlation between listing price and square feet. meaning that the 
square footage of a home somewhat affects the price of a home. This is true 
regardless of county population size. 

```{r plot} 

cor(sample_rcdf$median_listing_price, sample_rcdf$median_square_feet, use= 'pairwise.complete.obs')

model <- lm(median_square_feet~median_listing_price, data=sample_rcdf)
model

ggplot(sample_rcdf, aes(median_listing_price / 1000, median_square_feet,)) + 
  geom_point() + scale_x_log10() + scale_y_log10() + 
  geom_smooth(method = 'lm', se= FALSE)


ggplot(sample_rcdf, aes(median_listing_price / 1000, median_square_feet,
                  color= county_pop_size, shape=largest_race_group )) + geom_point() +
  scale_x_log10() + scale_y_log10()

``` 


There is not a strong correlation between housing prices and county population 
size. This means that independent of what the county population is, the median 
listing price varies. 
```{r shapefile}

cor(sample_rcdf$median_listing_price, sample_rcdf$total_pop, use= 'pairwise.complete.obs')

model <- lm(median_listing_price~total_pop + 0, data=sample_rcdf)
model

ggplot(sample_rcdf, aes(total_pop/ 1000, median_listing_price / 1000)) + 
  geom_point() + scale_x_log10() + scale_y_log10() + geom_smooth(method = 'lm', se= FALSE)


ggplot(sample_rcdf, aes(total_pop/ 1000, median_listing_price / 1000, color= county_pop_size, shape=largest_race_group)) + geom_point() + scale_x_log10() + scale_y_log10() 

```
The make up of the largest racial groups consist of mostly whites for the vast 
majority of counties regardless of county size. 
```{r categorical}
ggplot(sample_rcdf, aes(median_listing_price / 1000)) + geom_histogram() + facet_wrap(vars(largest_race_group))
```

When grouping majority racial makeup of a county with the county size, there is 
little to no correlation between the median square feet and the median listing 
price of homes across counties.

```{r grid}
ggplot(sample_rcdf, aes(median_square_feet / 1000, median_listing_price / 10000)) + geom_line(color= "blue") + 
  geom_smooth(method = 'lm', color= "red") + 
  labs(title = "Housing Price and Size by race/ethnicity and metropolitan type",
       x="Median Square Feet in the thousands", y= "Median Listing Price in the tens of thousands") + 
         facet_grid(largest_race_group ~ county_pop_size) + scale_x_log10() + scale_y_log10()
```

When looking at the relationship between median square feet and median listing 
price grouped by majority racial make up of a county, there was some positive
correlation for Whites and Native Americans where as median square footage 
increased, so did the value of the home. One can infer that both whites and 
Native Americans put value and pay a premium on the size of their home when 
compared to other races in other counties. There is a weaker correlation 
for Blacks and no correlation for Hispanics when it comes to paying a premium 
for larger houses. There is not enough information on all other races.
```{r race}

ggplot(sample_rcdf, aes(median_square_feet / 1000, median_listing_price / 10000, color=largest_race_group)) + geom_point() +  
  geom_smooth(method = 'lm') + 
  labs(title = "Housing Price and Size by race/ethnicity and metropolitan type",
       x="Median Square Feet in the thousands", y= "Median Listing Price in the tens of thousands") + 
         #facet_grid(largest_race_group ~ county_pop_size) 
  scale_x_log10() + scale_y_log10()

lm(median_listing_price~largest_race_group + 0, data = sample_rcdf)
```

```{r cor}
table_rcdf <- data.table::data.table(sample_rcdf)

race_group_cor <- table_rcdf[,as.list(cor(median_listing_price , median_square_feet)), by=largest_race_group]

colnames(race_group_cor) <- c('largest_race_group_by_county', 'med_list_price_med_sq_ft_correlation')

race_group_coef <- table_rcdf[,as.list(coef(lm(median_listing_price~median_square_feet))), by=largest_race_group]

colnames(race_group_coef) <- c('largest_race_group_by_county', 'Y-Intercept', 'coefficient')

race_group_df <- merge(data.frame(race_group_coef), data.frame(race_group_cor), by='largest_race_group_by_county')

race_group_df

```

